// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  role          UserRole  @default(CUSTOMER)
  orders        Order[]
  seller        Seller?   // Add this relation field
}

enum UserRole {
  CUSTOMER
  SELLER
  ADMIN
}

model Seller {
  id              String    @id @default(cuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  storeName       String
  description     String?   @db.Text
  contactEmail    String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  orders          Order[]   @relation("SellerOrders")
}

model Order {
  id              String      @id @default(cuid())
  userId          String
  user            User        @relation(fields: [userId], references: [id])
  sellerId        String
  seller          Seller      @relation("SellerOrders", fields: [sellerId], references: [id])
  status          OrderStatus @default(PENDING)
  totalAmount     Float
  items           OrderItem[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  shippingAddress String
  // Shipping tracking fields
  trackingNumber  String?
  carrier         ShippingCarrier?
  shippingStatus  ShippingStatus?  @default(PENDING)
  estimatedDeliveryDate DateTime?
  shippingEvents ShippingEvent[]
}

model OrderItem {
  id          String   @id @default(cuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id])
  productId   String
  quantity    Int
  unitPrice   Float
  totalPrice  Float
}

model ShippingEvent {
  id          String         @id @default(cuid())
  orderId     String
  order       Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  status      ShippingStatus
  location    String
  description String
  timestamp   DateTime       @default(now())
  createdAt   DateTime       @default(now())

  @@index([orderId])
  @@index([status])
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum ShippingStatus {
  PENDING
  PICKED_UP
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  EXCEPTION
}

enum ShippingCarrier {
  USPS
  UPS
  FEDEX
  DHL
}
